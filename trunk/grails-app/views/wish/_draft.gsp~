<%@ page import="wish.Wish" %>
			
 <h5><g:message code="wish.docDraftToBeApprovedBeforeDelivery.label" default="Doc Draft To Be Approved Before Delivery"/></h5>
	<div class="control-group fieldcontain ${hasErrors(bean: wishInstance, field: 'docDraftToBeApprovedBeforeDelivery', 'error')} ">
 		<table class="table table-hover">
 			<thead>
 				<tr>
                   	<th>${message(code: 'draft.description.label', default: 'Description')}</th>
                   	<th></th>
                   	<th></th>
                   	
                 </tr>
            </thead>
 			<tbody id="draft-table">
				<g:each var="draft" in="${wishInstance?.docDraftToBeApprovedBeforeDelivery}" status="i">
					<tr>
						<td> <g:textField name="description"/>${fieldValue(bean: draft, field: "description")}</td>
						
						<td>
	                  		<p><input type="file" id="btnAdd-draft-${i}" name="document"></p>
	                  		<p><a role="button" class="btn btn-small btn-primary btnRep" id="btnRep-draft-${i}"> ${message(code: 'default.button.replace.label', default: 'Replace file')}</a></p>							
						</td>
					
						<td><a href="#modalDeleteDocument" role="button" class="btn btn-small btn-primary" id="btnDel-draft-${i}"> ${message(code: 'wish.deleteDraft.label', default: 'Delete draft')}</a></td>
					</tr>
				</g:each>
            </tbody>
 		</table>
    </div>

	<span class="help-inline">${hasErrors(bean: wishInstance, field: 'docDraftToBeApprovedBeforeDelivery', 'error')}</span>
	<a role="button" class="btn btn-primary add-draft">${message(code: 'default.add.label', args: [message(code: 'draft.label', default: 'Draft')])}</a>
				
<script type="text/javascript">

var cantDraft = ${wishInstance?.docDraftToBeApprovedBeforeDelivery?.size()} + 0;

$(document).ready(function() {

	$(".add-draft").click(function()
	{		 
		var message =  "${message(code: 'wish.deleteDraft.label', default: 'Delete draft')}"; 
		var element = $("<tr> \
						 <td> <input type='text' id='text-draft-"+cantDraft+"' name='docDraftToBeApprovedBeforeDelivery[" + cantDraft + "].description'/></td> \
						 <td> <input type='file' id='file-draft-"+cantDraft+"' name='docDraftToBeApprovedBeforeDelivery[" + cantDraft + "].file'></td> \
						 <td> <a role='button' 	 id='btnDel-draft-"+cantDraft+"'class='btn btn-small btn-primary' onclick='delElement("+cantDraft+")'>" + message +"</a></td> \
						</tr>");

		$("#draft-table").append(element);
		
		cantDraft++;
	});
});

function delElement(nroRef)
{
	var nameBtnDel = "#btnDel-draft-"+ nroRef;
	$(nameBtnDel).parent().parent().remove();
	cantDraft--;

	var nameText, nameFile;
	for (var i = nroRef; i < cantDraft; i++)
	{
		nameText = "#text-draft-" + (i+1);
		nameFile = "#file-draft-" + (i+1);

		$(nameText).attr("name", "docDraftToBeApprovedBeforeDelivery[" + i + "].description");
		$(nameText).attr("id", "text-draft-" + i);		
		$(nameFile).attr("name", "docDraftToBeApprovedBeforeDelivery[" + i + "].file");
		$(nameFile).attr("id", "file-draft-" + i);
	}
	
}
</script>